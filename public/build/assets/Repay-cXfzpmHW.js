import{r as b,c as h,a as p,o as u,w as x,b as e,d as f,u as c,t as l,m as _,v as w,e as k,F,h as B,n as P,p as S,g as C,i as E}from"./app-KUgWEtTK.js";import{C as L,D,_ as K}from"./DashboardLayout-CBd3-9Qr.js";import{L as M}from"./loader-circle-COzy0sLb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-fdl4BT3X.js";import"./eye-CqiVPK0H.js";import"./menu-hSB8Arlo.js";const A={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 backdrop-blur-sm text-white px-4 lg:px-8 py-3 flex items-center space-x-2 text-sm border-b border-purple-500/20"},j={class:"p-4 lg:p-8"},z={class:"max-w-md mx-auto"},N={class:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-green-500/30 rounded-2xl p-6 shadow-2xl shadow-green-500/20"},V={class:"mb-6"},$={class:"text-center mb-4"},q={class:"text-3xl font-bold text-white mb-1"},R={class:"text-sm text-blue-300"},T={class:"grid grid-cols-2 gap-3 text-sm"},I={class:"text-center"},O={class:"font-bold text-white"},U={class:"text-center"},Y={class:"font-bold text-white"},G={class:"mb-6"},H={class:"relative"},J=["max"],Q={class:"flex justify-between mt-2"},W={class:"text-xs text-green-400"},X={class:"grid grid-cols-3 gap-2 mt-3"},Z=["onClick"],ee={class:"mb-6 p-3 bg-black/20 border border-blue-500/30 rounded-lg"},te={class:"flex justify-between items-center"},ae={class:"font-bold text-white"},se={class:"flex justify-between items-center mt-1"},ne={class:"font-bold text-green-400"},oe={class:"space-y-3"},le=["disabled"],be={__name:"Repay",props:{loan:{type:Object,required:!0},userBalance:{type:[Number,String],default:0}},setup(s){const r=s,i=b(!1),o=b(0),g=[1e3,5e3,1e4],y=h(()=>{const n=parseFloat(r.loan.monthly_payment?.replace(/[^0-9.]/g,"")||0),t=parseFloat(r.loan.balance?.replace(/[^0-9.]/g,"")||0),a=parseFloat(r.userBalance||0);let d=Math.min(n,t);return d=Math.min(d,a),d>0?d:1e3});o.value=y.value;const m=n=>(parseFloat(n)||0).toLocaleString("en-KE",{minimumFractionDigits:0,maximumFractionDigits:0}),v=async()=>{const n=parseFloat(o.value);if(n<=0){alert("Please enter a valid payment amount");return}if(n>parseFloat(r.userBalance)){alert("Insufficient balance for this payment");return}const t=parseFloat(r.loan.balance?.replace(/[^0-9.]/g,"")||0);if(n>t){alert("Payment amount cannot exceed loan balance");return}if(confirm(`Are you sure you want to make a payment of KES ${m(n)} for this loan?`)){i.value=!0;try{await E.post(`/loans/${r.loan.id}/repay`,{amount:n},{preserveScroll:!0,onSuccess:()=>{},onError:a=>{console.error("Payment error:",a),alert("Failed to process payment. Please try again."),i.value=!1}})}catch(a){console.error("Payment error:",a),alert("An unexpected error occurred. Please try again."),i.value=!1}}};return(n,t)=>(u(),p(K,{title:"Repay Loan"},{default:x(()=>[e("div",A,[f(c(L),{size:16,class:"text-purple-400"}),t[1]||(t[1]=e("span",null,"Loans",-1)),t[2]||(t[2]=e("span",{class:"text-purple-400"},"â€º",-1)),t[3]||(t[3]=e("span",{class:"text-purple-300"},"Repay Loan",-1))]),e("div",j,[e("div",z,[e("div",N,[t[12]||(t[12]=e("h2",{class:"text-xl font-bold text-white mb-6"},"Make Loan Payment",-1)),e("div",V,[e("div",$,[e("div",q,l(s.loan.amount),1),e("div",R,"Loan Balance: "+l(s.loan.balance),1)]),e("div",T,[e("div",I,[t[4]||(t[4]=e("div",{class:"text-blue-300"},"Monthly Payment",-1)),e("div",O,l(s.loan.monthly_payment),1)]),e("div",U,[t[5]||(t[5]=e("div",{class:"text-blue-300"},"Due Date",-1)),e("div",Y,l(s.loan.due_date),1)])])]),e("div",G,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-green-300 mb-2"}," Payment Amount (KES) ",-1)),e("div",H,[t[6]||(t[6]=e("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400"},"KES",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),type:"number",min:100,max:parseFloat(s.loan.balance.replace(/[^0-9.]/g,"")),step:"100",required:"",class:"w-full bg-black/30 border border-green-500/30 text-white rounded-xl pl-16 pr-4 py-3 focus:outline-none focus:border-green-400",placeholder:"Enter amount"},null,8,J),[[w,o.value]])]),e("div",Q,[t[7]||(t[7]=e("span",{class:"text-xs text-green-400"},"Min: KES 100",-1)),e("span",W,"Max: "+l(s.loan.balance),1)]),e("div",X,[(u(),k(F,null,B(g,a=>e("button",{key:a,type:"button",onClick:d=>o.value=a,class:P([o.value===a?"bg-green-600 text-white":"bg-black/30 text-green-300","border border-green-500/30 rounded-lg py-2 text-center text-sm transition-all duration-200"])}," KES "+l(a.toLocaleString()),11,Z)),64))])]),e("div",ee,[e("div",te,[t[9]||(t[9]=e("span",{class:"text-sm text-blue-300"},"Your Balance",-1)),e("span",ae,"KES "+l(m(s.userBalance)),1)]),e("div",se,[t[10]||(t[10]=e("span",{class:"text-sm text-blue-300"},"After Payment",-1)),e("span",ne,"KES "+l(m(s.userBalance-o.value)),1)])]),e("div",oe,[e("button",{onClick:v,disabled:i.value||parseFloat(o.value)>parseFloat(s.userBalance)||parseFloat(o.value)<=0,class:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 disabled:from-slate-600 disabled:to-slate-600 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2"},[i.value?(u(),p(c(M),{key:0,class:"animate-spin",size:20})):(u(),p(c(D),{key:1,size:20})),e("span",null,l(i.value?"Processing...":"Make Payment"),1)],8,le),f(c(S),{href:"/loans/my-loans",class:"w-full border border-purple-500/30 text-purple-400 hover:bg-purple-500/20 py-3 px-6 rounded-lg text-center block transition-all duration-200"},{default:x(()=>t[11]||(t[11]=[C(" Cancel ")])),_:1})])])])])]),_:1}))}};export{be as default};
